"0","set.seed(444)"
"0","n <- 50   # Numbers of data"
"0","q <- 2     # Number of covariables"
"0","G <- 3     # Number of groups"
"0",""
"0","X1 <- mvrnorm(n, mu = c(0,0), Sigma = rbind(c(0.5,0), # Group 1"
"0","                                            c(0,0.5)))"
"0","X2 <- mvrnorm(n, mu = c(3, 3), Sigma = rbind(c(0.5,0), # Group 2"
"0","                                            c(0,0.5)))"
"0","X3 <- mvrnorm(n, mu = c(-3, 4), Sigma = rbind(c(0.5,0), # Group 3"
"0","                                            c(0,0.5)))"
"0","X_tild <- cbind(rep(1,G*n), rbind(X1,X2,X3))"
"0","X_tild <- X_tild[sample(1:nrow(X_tild)),]"
"0",""
"0","S2.inv <- solve(rbind(c(0.5,0), c(0,0.5)))"
"0","w2 <- S2.inv %*% c(3,3)"
"0","w20 <- - c(3,3) %*% S2.inv %*% c(3,3)/2 + log(1/3)"
"0",""
"0","S3.inv <- solve(rbind(c(0.5,0), c(0,0.5)))"
"0","w3 <- S3.inv %*% c(-3,2)"
"0","w30 <- - c(-3,4) %*% S2.inv %*% c(-3,4)/2 + log(1/3)"
"0",""
"0","gamma <- matrix(c(0,0,0, c(w30,w3), c(w20,w2)), ncol=G)"
"0",""
"0","lin <- X_tild %*% gamma"
"0","eta <- exp(lin) / rowSums(exp(lin)) # Softmax to get proportions between 0 and 1"
"0",""
"0","# response var ----"
"0","sigma <- c(1, 0.5, 0.8)"
"0","beta <- matrix(c(0,1,1,0, -2,-1, 5,1,0), ncol = G)"
"0","group <- apply(eta, 1, function(p) sample(1:G, 1, prob = p))"
"0","means <- numeric(n)"
"0","for (i in 1:n) {"
"0","  means[i] <- X_tild[i, ] %*% beta[, group[i]]"
"0","}"
"0","y <- rnorm(G*n, mean = means, sd = sigma[group])"
"0","data <- data.frame(y = y, x0 = X_tild[,1], x1 = X_tild[, 2], x2 = X_tild[, 3], group = group)"
"0",""
"0","ggplot() +"
"0","  geom_point(aes(x = x1, y = x2, color = factor(group)), data = data) +"
"0","  labs(title = ""SMoE"","
"0","       x = ""x1"","
"0","       y = ""x2"","
"0","       color = ""Group"")"
